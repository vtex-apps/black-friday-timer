import React from 'react'

import styles from '../styles.css'
import Timer from 'react-compound-timer/build'

interface Props {
  initialTime: number
}

const BASE_TIME = 541234522 // Remaining time at the time of development. Used to calculate spinning speed.

let updateTimer = () => ''
const Circles: StorefrontFunctionComponent<Props> = ({ initialTime }) => {
  requestAnimationFrame(() => {
    const circles =
      window &&
      window.document &&
      Array.from(window.document.querySelectorAll('.circle'))

    if (circles) {
      let curTime = initialTime
      let curRotation = 0
      // Hack for keeping the animation in sync with the timer
      updateTimer = () => {
        curTime -= 1000
        const speedCalc = Math.pow(1 - curTime / BASE_TIME, 2)
        const baseSpeed = 10
        const speedIncrease = 270
        const speed = baseSpeed + speedCalc * speedIncrease
        curRotation += speed
        circles.forEach((circle: any, i) => {
          const mult = (i % 2 === 0 ? 1 : -1) * (1 + i * 0.5)
          circle.style.transform = `rotate(${curRotation * mult}deg)`
        })
        return ''
      }

      circles.forEach((circle: any) => {
        circle.style.transformOrigin = '50% 50%'
        circle.style.transition =
          'transform 1000ms cubic-bezier(0.215, 0.610, 0.355, 1.000)'
      })
    }
  })

  return (
    <>
      {/* Hack for keeping the animation in sync with the timer */}
      <Timer initialTime={initialTime}>
        {() => <Timer.Seconds formatValue={updateTimer} />}
      </Timer>
      <svg
        className={styles.circles}
        version="1.1"
        id="Camada_1"
        xmlns="http://www.w3.org/2000/svg"
        x="0"
        y="0"
        viewBox="0 0 1800 1778.6"
      >
        <path
          className="circle circle1"
          fill="#f42165"
          d="M899.6 1487.1c-39.5 0-79-4-117.9-11.9-71.5-14.5-139.1-41.9-201-81.3l2.7-4.2c61.4 39.2 128.5 66.3 199.4 80.7 68.4 13.9 138.2 15.5 207.6 4.8 82.3-12.7 159.4-41.8 229.2-86.6 72.2-46.3 132.4-106.8 178.8-179.8 42.8-67.4 71.1-141 84.2-218.9 12.7-75.3 10.6-151.4-6-226.3l4.9-1.1c16.8 75.5 18.9 152.2 6.1 228.2-13.2 78.5-41.8 152.8-84.9 220.7-46.8 73.6-107.5 134.6-180.4 181.3-70.4 45.2-148.2 74.6-231.2 87.4-30.5 4.7-61.1 7-91.5 7zM331.5 1068.9c-52.2-167.8-28-348.8 66.3-496.5 38.2-60.1 86.2-112.3 142.5-155 54.4-41.2 115.1-72.6 180.6-93.3 168-53 349.8-29.1 498.8 65.5l-2.7 4.2c-147.7-93.8-328-117.4-494.6-64.9-64.9 20.5-125.1 51.7-179.1 92.5-55.9 42.3-103.4 94-141.3 153.7-93.5 146.5-117.5 326-65.8 492.4l-4.7 1.4z"
        />
        <path
          className="circle circle2"
          fill="#f42165"
          d="M899.6 1635.7c-41.1 0-82.2-3.4-123.1-10.3-98.1-16.5-190.8-52.2-275.7-106-91.9-58.5-168.1-134.3-226.5-225.3-28-43.6-51.5-90.4-69.8-139.1-18.2-48.3-31.4-98.6-39.3-149.6-13.5-87.3-11.5-175.3 6-261.4 18.1-89.3 52.3-173.8 101.6-251.1l4.2 2.7c-49 76.8-82.9 160.7-100.9 249.4-17.4 85.6-19.4 173-6 259.7 7.8 50.7 20.9 100.7 39 148.6 18.2 48.3 41.5 94.8 69.3 138.1 58 90.4 133.6 165.6 224.9 223.7 84.3 53.5 176.4 88.9 273.8 105.3 94.2 15.8 189.5 13.3 283.1-7.6l1.1 4.9c-53.4 12-107.6 18-161.7 18zM1527.3 1291l-4.2-2.7c117.3-184.8 146.9-410.3 81.2-618.8-25.7-81.2-64.6-156.6-115.8-224-53-69.9-117.6-129.4-192.2-176.8-183.3-117-407.8-147-616-82.3l-1.5-4.8c209.5-65.2 435.6-35 620.2 82.8 75.1 47.8 140.2 107.6 193.5 178 51.5 67.9 90.7 143.8 116.5 225.5 66.2 210 36.4 437.1-81.7 623.1z"
        />
        <path
          className="circle circle3"
          fill="#f42165"
          d="M29.4 1085.4c-25.2-113-28.3-228-9.1-341.8C40 626 82.8 514.7 147.4 413c35.2-55.3 76.4-106.7 122.4-152.7 44.8-44.7 94.5-84.7 147.8-118.9 52.3-33.6 108.4-61.7 166.8-83.7C642.2 35.8 702.6 20 763.8 10.5 868.5-5.6 974-3.2 1077.4 17.8c107.1 21.7 208.4 62.7 301.1 121.8l-2.7 4.2c-92.2-58.8-193-99.6-299.5-121.2C973.6 1.8 868.7-.6 764.6 15.5c-60.8 9.4-120.9 25.2-178.5 46.9-58 21.9-113.8 49.9-165.8 83.3-53 34-102.4 73.8-146.9 118.2-45.7 45.7-86.7 96.8-121.7 151.8C87.4 516.9 44.9 627.5 25.2 744.5c-19 113.1-16 227.5 9.1 339.9l-4.9 1zM899.8 1783.6c-167.5 0-333.5-47.3-478.6-139.5l2.7-4.2c144.3 91.6 309.4 138.7 475.9 138.7 89.5 0 179.5-13.6 267-41.2 97.5-30.9 188-77.6 269-139 83.9-63.6 155.3-141.2 212.3-230.8 35.8-56.2 65.3-116.1 87.6-178.3 21.6-60.4 36.7-123.4 44.6-187.2 7.8-62.6 8.9-126.3 3.2-189.3-5.6-62.6-18-124.7-36.6-184.7l4.8-1.5c18.8 60.3 31.2 122.8 36.8 185.8 5.7 63.4 4.6 127.5-3.2 190.4-8 64.1-23.1 127.5-44.9 188.3-22.4 62.5-52 122.8-88.1 179.3-57.3 90.1-129.1 168.2-213.5 232.1-81.4 61.7-172.4 108.7-270.5 139.8-87.9 27.6-178.4 41.3-268.5 41.3z"
        />
      </svg>
    </>
  )
}

export default Circles
